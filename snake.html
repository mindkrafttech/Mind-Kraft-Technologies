<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Offline Snake Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 10px;
    }

    .container {
      text-align: center;
      padding: 16px;
      width: 100%;
      max-width: 420px;
      background: #020617;
      border-radius: 16px;
      border: 1px solid #1f2937;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
    }

    h1 {
      margin-bottom: 6px;
      font-size: 1.4rem;
    }

    .info {
      margin-bottom: 10px;
      font-size: 0.8rem;
      opacity: 0.8;
    }

    .score-board {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    canvas {
      background: #020617;
      border: 1px solid #374151;
      border-radius: 10px;
      display: block;
      margin: 0 auto 10px;

      width: 100%;
      max-width: 380px;
      aspect-ratio: 1 / 1;
    }

    .controls-main,
    .btn-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-top: 4px;
    }

    .controls-main {
      margin-bottom: 8px;
    }

    button {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #111827;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 0.85rem;
      min-width: 60px;
      transition: background 0.15s, transform 0.07s;
    }

    button:hover {
      background: #0b1120;
    }

    button:active {
      transform: scale(0.97);
    }

    .dir-btn {
      font-size: 1rem;
      min-width: 44px;
    }

    .small-note {
      margin-top: 4px;
      font-size: 0.72rem;
      opacity: 0.7;
    }

    .status {
      font-size: 0.8rem;
      margin-bottom: 6px;
      opacity: 0.85;
    }

    .status span {
      font-weight: 600;
    }

    #online-message {
      font-size: 0.9rem;
      line-height: 1.4;
    }

    #online-message a {
      color: #38bdf8;
      text-decoration: none;
    }

    #online-message a:hover {
      text-decoration: underline;
    }

    @media (max-width: 400px) {
      .container {
        padding: 12px;
        border-radius: 12px;
      }
      h1 {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- ONLINE MESSAGE (shown when internet is ON) -->
    <div id="online-message" style="display: none;">
      <h1>Offline Snake Game</h1>
      <p class="info">This game is only available when you are <b>offline</b>.</p>
      <p style="margin-top:8px;">
        Please turn off your internet and open this page again.<br />
        <a href="index.html">← Go back to website</a>
      </p>
    </div>

    <!-- OFFLINE GAME (shown only when internet is OFF) -->
    <div id="offline-wrapper" style="display: none;">
      <h1>Offline Snake</h1>
      <p class="info">You are offline. Use arrow keys or buttons. Tap <b>Start</b> to play.</p>

      <div class="score-board">
        <span>Score: <span id="score">0</span></span>
        <span>High Score: <span id="high-score">0</span></span>
      </div>

      <p class="status">Status: <span id="status-text">Ready (offline)</span></p>

      <canvas id="gameCanvas" width="400" height="400"></canvas>

      <div class="controls-main">
        <button id="btn-start">Start</button>
        <button id="btn-pause">Pause</button>
        <button id="btn-reset-score">Reset Score</button>
      </div>

      <div class="btn-row">
        <button class="dir-btn" id="btn-up">▲</button>
      </div>
      <div class="btn-row">
        <button class="dir-btn" id="btn-left">◀</button>
        <button class="dir-btn" id="btn-down">▼</button>
        <button class="dir-btn" id="btn-right">▶</button>
      </div>

      <p class="small-note">
        Game speed increases as your score increases, like Dino difficulty.
      </p>
    </div>
  </div>

  <script>
    // ---------- ONLINE / OFFLINE HANDLER ----------
    const onlineMessage = document.getElementById("online-message");
    const offlineWrapper = document.getElementById("offline-wrapper");

    function handleOnlineStatus() {
      if (navigator.onLine) {
        // ONLINE → show message, hide game, stop game loop
        onlineMessage.style.display = "block";
        offlineWrapper.style.display = "none";
        stopGameCompletely();
      } else {
        // OFFLINE → show game, hide online message
        onlineMessage.style.display = "none";
        offlineWrapper.style.display = "block";
        if (!initialized) {
          initGame();
        }
      }
    }

    window.addEventListener("online", handleOnlineStatus);
    window.addEventListener("offline", handleOnlineStatus);

    // ---------- SNAKE GAME CODE (OFFLINE ONLY) ----------
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const scoreEl = document.getElementById("score");
    const highScoreEl = document.getElementById("high-score");
    const statusText = document.getElementById("status-text");

    const btnStart = document.getElementById("btn-start");
    const btnPause = document.getElementById("btn-pause");
    const btnResetScore = document.getElementById("btn-reset-score");

    const gridSize = 20;
    const tileSize = canvas.width / gridSize;

    let snake, direction, food, score, highScore, gameLoopId, speed;
    let isRunning = false;
    let isGameOver = false;
    let initialized = false;

    function initGame() {
      snake = [
        { x: 10, y: 10 },
        { x: 9,  y: 10 },
        { x: 8,  y: 10 }
      ];

      direction = { x: 1, y: 0 }; // moving right
      food = randomFoodPosition();
      score = 0;
      speed = 150;
      isGameOver = false;
      isRunning = false;
      initialized = true;

      scoreEl.textContent = score;

      highScore = parseInt(localStorage.getItem("snakeHighScore") || "0", 10);
      highScoreEl.textContent = highScore;

      statusText.textContent = "Ready (offline)";
      btnStart.textContent = "Start";
      btnPause.textContent = "Pause";

      if (gameLoopId) {
        clearInterval(gameLoopId);
        gameLoopId = null;
      }

      draw();
    }

    function stopGameCompletely() {
      if (gameLoopId) {
        clearInterval(gameLoopId);
        gameLoopId = null;
      }
      isRunning = false;
    }

    function startLoop() {
      if (navigator.onLine) return; // extra safety
      if (isRunning || isGameOver) return;

      gameLoopId = setInterval(gameTick, speed);
      isRunning = true;
      statusText.textContent = "Playing (offline)";
      btnStart.textContent = "Restart";
    }

    function pauseGame() {
      if (navigator.onLine) return; // safety
      if (!isRunning && !isGameOver) {
        startLoop();
        btnPause.textContent = "Pause";
        return;
      }

      if (isRunning) {
        clearInterval(gameLoopId);
        gameLoopId = null;
        isRunning = false;
        statusText.textContent = "Paused (offline)";
        btnPause.textContent = "Resume";
      }
    }

    function resetScore() {
      localStorage.removeItem("snakeHighScore");
      highScore = 0;
      highScoreEl.textContent = 0;
      score = 0;
      scoreEl.textContent = 0;
      initGame();
    }

    function randomFoodPosition() {
      let newFood;
      while (true) {
        newFood = {
          x: Math.floor(Math.random() * gridSize),
          y: Math.floor(Math.random() * gridSize)
        };
        const onSnake = snake.some(seg => seg.x === newFood.x && seg.y === newFood.y);
        if (!onSnake) break;
      }
      return newFood;
    }

    function gameTick() {
      update();
      draw();
    }

    function update() {
      const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

      // Wall collision
      if (head.x < 0 || head.x >= gridSize || head.y < 0 || head.y >= gridSize) {
        return gameOver();
      }

      // Self collision
      if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
        return gameOver();
      }

      snake.unshift(head);

      // Eat food
      if (head.x === food.x && head.y === food.y) {
        score++;
        scoreEl.textContent = score;

        if (score > highScore) {
          highScore = score;
          highScoreEl.textContent = highScore;
          localStorage.setItem("snakeHighScore", highScore);
        }

        food = randomFoodPosition();

        // Increase speed over time
        if (score % 3 === 0 && speed > 60) {
          speed -= 5;
          clearInterval(gameLoopId);
          gameLoopId = setInterval(gameTick, speed);
        }
      } else {
        snake.pop();
      }
    }

    function draw() {
      ctx.fillStyle = "#020617";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.strokeStyle = "#111827";
      for (let i = 0; i < gridSize; i++) {
        ctx.beginPath();
        ctx.moveTo(i * tileSize, 0);
        ctx.lineTo(i * tileSize, canvas.height);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(0, i * tileSize);
        ctx.lineTo(canvas.width, i * tileSize);
        ctx.stroke();
      }

      snake.forEach((seg, index) => {
        ctx.fillStyle = index === 0 ? "#22c55e" : "#16a34a";
        ctx.fillRect(seg.x * tileSize, seg.y * tileSize, tileSize - 1, tileSize - 1);
      });

      ctx.fillStyle = "#f97316";
      ctx.fillRect(food.x * tileSize, food.y * tileSize, tileSize - 1, tileSize - 1);
    }

    function gameOver() {
      clearInterval(gameLoopId);
      gameLoopId = null;
      isRunning = false;
      isGameOver = true;
      statusText.textContent = "Game Over (offline)";
      alert("Game Over! Your score: " + score);
      btnPause.textContent = "Pause";
    }

    // Keyboard controls
    document.addEventListener("keydown", (e) => {
      if (navigator.onLine) return; // no controls when online

      const key = e.key;

      if (key === "ArrowUp" && direction.y !== 1) {
        direction = { x: 0, y: -1 };
      } else if (key === "ArrowDown" && direction.y !== -1) {
        direction = { x: 0, y: 1 };
      } else if (key === "ArrowLeft" && direction.x !== 1) {
        direction = { x: -1, y: 0 };
      } else if (key === "ArrowRight" && direction.x !== -1) {
        direction = { x: 1, y: 0 };
      } else if (key === " " && !isRunning && !isGameOver && !navigator.onLine) {
        startLoop();
      }
    });

    // Mobile direction buttons
    document.getElementById("btn-up").addEventListener("click", () => {
      if (direction.y !== 1) direction = { x: 0, y: -1 };
    });
    document.getElementById("btn-down").addEventListener("click", () => {
      if (direction.y !== -1) direction = { x: 0, y: 1 };
    });
    document.getElementById("btn-left").addEventListener("click", () => {
      if (direction.x !== 1) direction = { x: -1, y: 0 };
    });
    document.getElementById("btn-right").addEventListener("click", () => {
      if (direction.x !== -1) direction = { x: 1, y: 0 };
    });

    // Buttons
    btnStart.addEventListener("click", () => {
      if (navigator.onLine) return;
      if (isGameOver) {
        initGame();
        startLoop();
      } else if (!isRunning) {
        startLoop();
      } else {
        initGame();
        startLoop();
      }
    });

    btnPause.addEventListener("click", () => {
      if (!isGameOver) pauseGame();
    });

    btnResetScore.addEventListener("click", () => {
      resetScore();
    });

    // Service worker registration (for offline cache)
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js").catch((err) =>
        console.log("SW registration failed:", err)
      );
    }

    // First check online/offline and then maybe init
    handleOnlineStatus();
  </script>
</body>
</html>
